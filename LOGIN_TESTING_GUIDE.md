# üß™ GU√çA DE PRUEBAS - LOGIN COMPONENT

## ‚úÖ LOGIN IMPLEMENTADO COMPLETAMENTE

El componente de Login ha sido implementado con todas las caracter√≠sticas modernas de Angular 20.

---

## üìã CARACTER√çSTICAS IMPLEMENTADAS

### 1. **Formulario Reactivo**
- ‚úÖ Validaci√≥n de email
- ‚úÖ Validaci√≥n de contrase√±a (m√≠nimo 6 caracteres)
- ‚úÖ Mensajes de error personalizados
- ‚úÖ Feedback visual (campos inv√°lidos en rojo)

### 2. **Signals (Estado Reactivo)**
- ‚úÖ `loading` - Estado de carga
- ‚úÖ `error` - Mensajes de error
- ‚úÖ `showPassword` - Toggle de visibilidad

### 3. **Experiencia de Usuario**
- ‚úÖ Bot√≥n "mostrar/ocultar contrase√±a"
- ‚úÖ Loading spinner durante login
- ‚úÖ Mensajes de error claros y espec√≠ficos
- ‚úÖ Deshabilitar botones durante carga
- ‚úÖ Auto-focus en email despu√©s de error
- ‚úÖ Limpiar errores al escribir

### 4. **Manejo de Errores**
- ‚úÖ Error 401 - Credenciales incorrectas
- ‚úÖ Error 422 - Validaci√≥n del servidor
- ‚úÖ Error 0 - Sin conexi√≥n al servidor
- ‚úÖ Errores gen√©ricos

### 5. **Redirecci√≥n Inteligente**
- ‚úÖ Seg√∫n rol (admin ‚Üí `/admin/dashboard`, client ‚Üí `/client/dashboard`)
- ‚úÖ Return URL (volver a la p√°gina que intentabas visitar)

### 6. **Dise√±o Moderno**
- ‚úÖ Gradiente animado de fondo
- ‚úÖ Tarjeta flotante con sombras
- ‚úÖ Animaciones suaves
- ‚úÖ Responsive (m√≥vil y desktop)
- ‚úÖ Bootstrap Icons

---

## üöÄ C√ìMO PROBAR

### **Paso 1: Iniciar el servidor Angular**

```bash
cd C:\projects\kd\siceweb
npm start
```

Espera a que compile y abre: `http://localhost:4200`

---

### **Paso 2: Iniciar el backend Laravel**

```bash
cd C:\projects\kd\siceapi
php artisan serve
```

Debe estar corriendo en: `http://localhost:8000`

---

### **Paso 3: Probar el Login**

#### **OPCI√ìN A: Con Backend Laravel (Real)**

Si tienes usuarios en la base de datos:

```
Email: admin@example.com (o el que tengas)
Password: password (o la que hayas configurado)
```

**Flujo esperado:**
1. Ingresas credenciales
2. Click en "Iniciar Sesi√≥n"
3. Loading spinner aparece
4. AuthService hace petici√≥n a `http://localhost:8000/api/auth/login`
5. auth-interceptor agrega token JWT
6. Backend valida y responde
7. Signal `currentUser` se actualiza
8. Guards permiten acceso
9. Redirige a dashboard seg√∫n rol
10. Navbar muestra tu nombre
11. Sidebar muestra men√∫ seg√∫n rol

---

#### **OPCI√ìN B: Sin Backend (Testing de UI)**

Puedes probar la validaci√≥n del formulario sin backend:

**Casos de prueba:**

1. **Email inv√°lido**
   - Email: `test`
   - Password: `123456`
   - Resultado: "Ingresa un email v√°lido"

2. **Contrase√±a corta**
   - Email: `test@example.com`
   - Password: `123`
   - Resultado: "M√≠nimo 6 caracteres"

3. **Campos vac√≠os**
   - Dejar ambos campos vac√≠os
   - Click en "Iniciar Sesi√≥n"
   - Resultado: "Este campo es requerido"

4. **Toggle contrase√±a**
   - Escribir contrase√±a
   - Click en √≠cono de ojo
   - Resultado: Contrase√±a visible/oculta

---

### **Paso 4: Probar Guards**

#### **Test 1: Sin autenticaci√≥n**
1. En nueva pesta√±a inc√≥gnita: `http://localhost:4200/admin/dashboard`
2. Resultado esperado: Redirige a `/auth/login`
3. URL incluye `?returnUrl=/admin/dashboard`

#### **Test 2: Rol incorrecto**
1. Login como Cliente
2. Intentar acceder: `http://localhost:4200/admin/dashboard`
3. Resultado esperado: Redirige a `/client/dashboard`

---

### **Paso 5: Probar Interceptors**

Abre DevTools (F12) ‚Üí Network:

1. Haz login
2. En Network busca la petici√≥n a `/api/auth/login`
3. Verifica headers:
   - `Authorization: Bearer [token]` (agregado por interceptor)
4. Si ves 401, el error-interceptor har√° logout autom√°tico

---

## üé® VISTA PREVIA DEL LOGIN

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                           ‚ïë
‚ïë          [Icono de Contenedor]            ‚ïë
‚ïë                                           ‚ïë
‚ïë      Sice Group Dashboard                 ‚ïë
‚ïë   Ingresa a tu cuenta para continuar      ‚ïë
‚ïë                                           ‚ïë
‚ïë   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚ïë
‚ïë   ‚îÇ ‚úâ Correo Electr√≥nico            ‚îÇ    ‚ïë
‚ïë   ‚îÇ tu@email.com                    ‚îÇ    ‚ïë
‚ïë   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚ïë
‚ïë                                           ‚ïë
‚ïë   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚ïë
‚ïë   ‚îÇ üîí Contrase√±a            ‚îÇ üëÅ   ‚îÇ    ‚ïë
‚ïë   ‚îÇ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢                 ‚îÇ     ‚îÇ    ‚ïë
‚ïë   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚ïë
‚ïë                                           ‚ïë
‚ïë   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚ïë
‚ïë   ‚îÇ   ‚û°Ô∏è  Iniciar Sesi√≥n            ‚îÇ    ‚ïë
‚ïë   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚ïë
‚ïë                                           ‚ïë
‚ïë        üîë ¬øOlvidaste tu contrase√±a?       ‚ïë
‚ïë                                           ‚ïë
‚ïë   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ     ‚ïë
‚ïë   üõ° Conexi√≥n segura con SSL              ‚ïë
‚ïë                                           ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

## üîç VERIFICACI√ìN DEL FLUJO COMPLETO

### **1. Verificar Signals funcionando**

Abre DevTools Console y ejecuta:

```javascript
// El currentUser signal debe actualizarse despu√©s del login
ng.getComponent($0) // Selecciona el componente
```

### **2. Verificar Guards**

En DevTools Console:

```javascript
// Despu√©s del login, intenta acceder directamente
window.location.href = '/admin/dashboard'
// Si eres cliente, el roleGuard te redirigir√° a /client/dashboard
```

### **3. Verificar Interceptors**

En Network tab:
- Todas las peticiones HTTP deben tener `Authorization: Bearer ...`
- Si no lo tienen, el interceptor no est√° funcionando

### **4. Verificar LocalStorage**

En DevTools ‚Üí Application ‚Üí Local Storage:

```
sice_token: "eyJ0eXAiOiJKV1..."
sice_user: "{"id":1,"name":"Admin"...}"
```

---

## ‚ö†Ô∏è PROBLEMAS COMUNES

### **Problema 1: CORS Error**

**Error:** `Access to XMLHttpRequest has been blocked by CORS policy`

**Soluci√≥n:**

En Laravel (`C:\projects\kd\siceapi\config\cors.php`):

```php
'allowed_origins' => [
    'http://localhost:4200',  // ‚Üê Agregar esto
],
```

---

### **Problema 2: Cannot connect to API**

**Error:** "No se pudo conectar con el servidor"

**Verificar:**
1. Laravel est√° corriendo en `http://localhost:8000`
2. Environment.ts tiene `apiBase: 'http://localhost:8000/api'`

---

### **Problema 3: Guards no redirigen**

**Verificar:**
1. `app.routes.ts` tiene `canActivate: [authGuard, adminGuard]`
2. Token JWT no ha expirado
3. Signal `currentUser` tiene datos

---

### **Problema 4: Interceptor no agrega token**

**Verificar:**
1. `app.config.ts` tiene `provideHttpClient(withInterceptors([...]))`
2. Token existe en localStorage
3. AuthService.getToken() retorna el token

---

## üìä FLUJO DE DATOS VISUAL

```
1. USUARIO ESCRIBE EMAIL Y PASSWORD
   ‚Üì
2. COMPONENTE VALIDA FORMULARIO
   ‚Üì
3. LLAMA AuthService.login(credentials)
   ‚Üì
4. AuthService hace http.post('/api/auth/login')
   ‚Üì
5. auth-interceptor agrega "Authorization: Bearer token"
   ‚Üì
6. PETICI√ìN VA AL BACKEND LARAVEL
   ‚Üì
7. Backend valida y responde { access_token, user }
   ‚Üì
8. AuthService guarda token en localStorage
   ‚Üì
9. AuthService actualiza signal: currentUser.set(user)
   ‚Üì
10. COMPONENTE DETECTA CAMBIO (autom√°tico con signals)
   ‚Üì
11. REDIRIGE seg√∫n rol:
    - Admin ‚Üí /admin/dashboard (con adminGuard)
    - Client ‚Üí /client/dashboard (con clientGuard)
    ‚Üì
12. Guards verifican autenticaci√≥n y rol
    ‚Üì
13. DASHBOARD SE RENDERIZA
    - Navbar muestra nombre del usuario
    - Sidebar muestra men√∫ seg√∫n rol
```

---

## üéØ CHECKLIST DE TESTING

### **Frontend (UI)**
- [ ] Formulario valida email formato correcto
- [ ] Formulario valida contrase√±a m√≠nimo 6 caracteres
- [ ] Bot√≥n muestra loading spinner durante petici√≥n
- [ ] Bot√≥n est√° deshabilitado durante carga
- [ ] Toggle contrase√±a funciona (ojo/ojo tachado)
- [ ] Mensajes de error se muestran correctamente
- [ ] Mensajes de error se limpian al escribir
- [ ] Auto-focus en email despu√©s de error
- [ ] Dise√±o responsive en m√≥vil
- [ ] Animaciones funcionan suavemente

### **Integraci√≥n con Backend**
- [ ] Petici√≥n se env√≠a a `http://localhost:8000/api/auth/login`
- [ ] auth-interceptor agrega header Authorization
- [ ] Token JWT se guarda en localStorage
- [ ] Usuario se guarda en localStorage
- [ ] Signal currentUser se actualiza

### **Guards**
- [ ] authGuard bloquea acceso sin token
- [ ] authGuard detecta token expirado
- [ ] adminGuard permite acceso solo a admins
- [ ] clientGuard permite acceso solo a clientes
- [ ] Redirecci√≥n con returnUrl funciona

### **Interceptors**
- [ ] auth-interceptor agrega token a TODAS las peticiones
- [ ] error-interceptor detecta 401 y hace logout
- [ ] error-interceptor detecta 422 y muestra errores de validaci√≥n
- [ ] error-interceptor detecta error 0 (sin conexi√≥n)

### **Navegaci√≥n**
- [ ] Admin redirige a `/admin/dashboard`
- [ ] Cliente redirige a `/client/dashboard`
- [ ] Navbar muestra nombre del usuario
- [ ] Sidebar muestra men√∫ seg√∫n rol
- [ ] Logout funciona correctamente

---

## üöÄ PR√ìXIMOS PASOS

Ahora que el login funciona, puedes implementar:

1. **Password Reset Component**
2. **Client CRUD** (Lista, Crear, Editar)
3. **Order CRUD**
4. **Container Tracking**
5. **Notifications System**

---

## üí° TIPS DE DESARROLLO

### **Tip 1: Usar datos de prueba**

Si no tienes usuarios en la BD, crea uno:

```bash
php artisan tinker

User::create([
    'name' => 'Admin Test',
    'email' => 'admin@test.com',
    'password' => bcrypt('123456'),
    'role' => 'administrator',
    'status' => 'active'
]);
```

### **Tip 2: Ver requests en DevTools**

Network tab ‚Üí Filter ‚Üí XHR ‚Üí Ver todas las peticiones HTTP

### **Tip 3: Debuggear Signals**

En el componente:
```typescript
effect(() => {
  console.log('User changed:', this.authService.currentUser());
});
```

### **Tip 4: Simular errores**

En el componente, comenta temporalmente la petici√≥n real:

```typescript
// Simular error
this.error.set('Credenciales incorrectas (simulado)');
this.loading.set(false);
```

---

¬°El login est√° listo para usarse! üéâ
