<div class="client-list-page">
  <!-- Toolbar: Search + Add Button -->
  <app-page-toolbar
    [showSearch]="true"
    [showFilters]="false"
    addButtonText="Agregar Nuevo Cliente"
    (searchChange)="onSearch($event)"
    (addClick)="onAddClient()">
  </app-page-toolbar>

  <!-- Data Table -->
  <app-data-table
    [columns]="columns"
    [data]="clients()"
    [actions]="actions"
    [loading]="loading()"
    [rowClassFn]="getClientRowClass"
    emptyMessage="No hay clientes registrados"
    (actionClick)="onTableAction($event)">

    <!-- Template para cards en móvil -->
    <ng-template #cardTemplate let-client let-onAction="onAction" let-rowClass="rowClass">
      <div class="client-card" [class.card-inactive]="client.user?.status === 'inactive'">
        <!-- Header: Empresa y Estado -->
        <div class="card-header-row">
          <span class="field-value company-name">{{ client.company_name || '-' }}</span>
          <span [class]="'status-badge ' + (client.user?.status === 'active' ? 'badge-active' : 'badge-inactive')">
            {{ client.user?.status === 'active' ? 'Activo' : 'Inactivo' }}
          </span>
        </div>

        <!-- Contacto -->
        <div class="card-field">
          <span class="field-label">Contacto</span>
          <span class="field-value">{{ client.user?.name || '-' }}</span>
        </div>

        <!-- Correo Electrónico -->
        <div class="card-field">
          <span class="field-label">Correo Electrónico</span>
          <span class="field-value">{{ client.user?.email || '-' }}</span>
        </div>

        <!-- Teléfono y RUT en la misma fila -->
        <div class="card-row">
          <div class="card-field">
            <span class="field-label">Teléfono</span>
            <span class="field-value">{{ client.phone || '-' }}</span>
          </div>
          <div class="card-field">
            <span class="field-label">RUT</span>
            <span class="field-value">{{ client.rut || '-' }}</span>
          </div>
        </div>

        <!-- Acciones -->
        <div class="card-actions">
          <button class="btn-view" (click)="onAction({ action: 'view', row: client })">
            <i class="bi bi-eye"></i>
            <span>Ver detalles</span>
          </button>
          <button class="btn-edit" (click)="onAction({ action: 'edit', row: client })">
            <i class="bi bi-pencil-square"></i>
            <span>Editar</span>
          </button>
        </div>
      </div>
    </ng-template>
  </app-data-table>

  <!-- Pagination -->
  <app-pagination
    [currentPage]="currentPage()"
    [totalPages]="totalPages()"
    [totalItems]="totalItems()"
    [perPage]="perPage()"
    (pageChange)="onPageChange($event)">
  </app-pagination>

  <!-- Modal -->
  @if (showModal()) {
    <app-client-modal
      [mode]="modalMode()"
      [clientId]="selectedClientId()"
      (close)="onCloseModal()"
      (save)="onClientSaved($event)">
    </app-client-modal>
  }
</div>
