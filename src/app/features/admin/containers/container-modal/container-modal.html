<app-modal
  [title]="getTitle()"
  [size]="'md'"
  (close)="onClose()">

  @if (loading()) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2 text-muted">Buscando contenedor en Shipsgo...</p>
    </div>
  } @else {
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <!-- Número de contenedor -->
      <div class="mb-3">
        <label class="form-label">Número de contenedor <span class="text-dark">(*)</span></label>
        <input
          type="text"
          class="form-control"
          formControlName="container_number"
          placeholder="Ej: ABCD1234567"
          [class.is-invalid]="form.get('container_number')?.invalid && form.get('container_number')?.touched">
        @if (form.get('container_number')?.invalid && form.get('container_number')?.touched) {
          <div class="invalid-feedback">
            @if (form.get('container_number')?.errors?.['required']) {
              Este campo es requerido
            }
            @if (form.get('container_number')?.errors?.['pattern']) {
              Formato inválido. Use: ABCD1234567 (4 letras seguidas de 7 números)
            }
          </div>
        }
      </div>

      <!-- Número de referencia -->
      <div class="mb-3">
        <label class="form-label">Número de referencia <span class="text-dark">(*)</span></label>
        <input
          type="text"
          class="form-control"
          formControlName="shipment_reference"
          placeholder="Ingrese el número de referencia"
          [class.is-invalid]="form.get('shipment_reference')?.invalid && form.get('shipment_reference')?.touched">
        @if (form.get('shipment_reference')?.invalid && form.get('shipment_reference')?.touched) {
          <div class="invalid-feedback">
            @if (form.get('shipment_reference')?.errors?.['required']) {
              Este campo es requerido
            }
          </div>
        }
      </div>
    </form>
  }

  <!-- Footer -->
  <div footer>
    <button
      type="button"
      class="btn btn-secondary"
      (click)="onClose()"
      [disabled]="loading()">
      Cancelar
    </button>
    <button
      type="button"
      class="btn btn-primary"
      (click)="onSubmit()"
      [disabled]="form.invalid || loading()">
      @if (loading()) {
        <span class="spinner-border spinner-border-sm me-2"></span>
        Agregando contenedor...
      } @else {
        {{ mode === 'create' ? 'Agregar' : 'Guardar' }}
      }
    </button>
  </div>
</app-modal>

<!-- Modal de confirmación para contenedor nuevo -->
@if (showNewContainerConfirm()) {
  <app-confirmation-modal
    type="info"
    [message]="newContainerMessage()"
    [showCancel]="true"
    (confirm)="onConfirmNewContainer()"
    (cancel)="onCancelNewContainer()">
  </app-confirmation-modal>
}

<!-- Modal de notificación -->
@if (showNotification()) {
  <app-confirmation-modal
    [type]="notificationType()"
    [message]="notificationMessage()"
    [showCancel]="false"
    (confirm)="onNotificationConfirm()">
  </app-confirmation-modal>
}
